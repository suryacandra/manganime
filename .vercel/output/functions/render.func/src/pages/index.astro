---
import Layout from "../layouts/Layout.astro";
import cheerio from "cheerio";
import {fetcher} from '../../lib/helper'
// import puppeteer from 'puppeteer'

// const test = async () => {
//   try {
//     const browser = await puppeteer.launch();
//     const [page] = await browser.pages();

//     await page.goto('https://animixplay.to/v1/do-it-yourself/ep8', { waitUntil: 'networkidle0' });

//     const data = await page.content()
//     console.log(data);

//     await browser.close();
//   }
//   catch(err) {
//     console.error(err);
//   }
// }

// test()

// const response = await fetch('https://codespaces-nextjs.vercel.app/api/remote', {
//   method: 'POST',
//   headers: {
//     'Content-Type': 'application/json'
//   },
//   body: JSON.stringify({
//     url: 'https://hxfile.co/embed-11uanpigh2v0.html'
//   })
// })

// const response = await fetch('https://hxfile.co/embed-11uanpigh2v0.html')

// const data = await response.json()
// const $ = cheerio.load(data)
// const newData = $.html()
// console.log(data)

// const chainsaw = await fetcher('https://65.108.132.145/anime/chainsaw-man/')
// const one_piece = await fetcher('https://65.108.132.145/anime/one-piece/')
// const spy_family = await fetcher('https://65.108.132.145/anime/spy-family')
// const boruto = await fetcher('https://65.108.132.145/anime/boruto-naruto-next-generations/')
// const bleach = await fetcher('https://65.108.132.145/anime/bleach/')
// const boku_no_hero = await fetcher('https://65.108.132.145/anime/boku-no-hero-academia-season-6/')
// const data = [chainsaw, one_piece]
const arr = []
const $ = await fetcher('https://m.meownime.ai/tag/ongoing')
$('#main > article').each((i, el) => {
	const title = $(el).find("div > a").attr('title')
	const episode = $(el).find("div > .postedon").text()
	const image = $(el).find("div > a > img").attr('src')
	const obj = {
		title,
		image,
		link: `/anime/${title.replace(/[\s:]+/g, "-") + '-' + episode.replace(/,?[ ]/g, '-')}`,
		anime: title.replace(/[\s:]+/g, "-"),
    episode,
	}
	arr.push(obj)
})
const $$ = await fetcher('https://m.meownime.ai/tag/ongoing/page/2/')
$$('#main > article').each((i, el) => {
	const title = $(el).find("div > a").attr('title')
	const episode = $(el).find("div > .postedon").text()
	const image = $(el).find("div > a > img").attr('src')
	const obj = {
		title,
		image,
		link: `/anime/${title.replace(/[\s:]+/g, "-") + '-' + episode.replace(/,?[ ]/g, '-')}`,
		anime: title.replace(/[\s:]+/g, "-"),
    episode,
	}
	arr.push(obj)
})
const $$$ = await fetcher('https://m.meownime.ai/tag/ongoing/page/3/')
$$$('#main > article').each((i, el) => {
	const title = $(el).find("div > a").attr('title')
	const episode = $(el).find("div > .postedon").text()
	const image = $(el).find("div > a > img").attr('src')
	const obj = {
		title,
		image,
		link: `/anime/${title.replace(/[\s:]+/g, "-") + '-' + episode.replace(/,?[ ]/g, '-')}`,
		anime: title.replace(/[\s:]+/g, "-"),
    episode,
	}
	arr.push(obj)
})
const $$$$ = await fetcher('https://m.meownime.ai/tag/ongoing/page/4/')
$$$$('#main > article').each((i, el) => {
	const title = $(el).find("div > a").attr('title')
	const episode = $(el).find("div > .postedon").text()
	const image = $(el).find("div > a > img").attr('src')
	const obj = {
		title,
		image,
		link: `/anime/${title.replace(/[\s:]+/g, "-") + '-' + episode.replace(/,?[ ]/g, '-')}`,
		anime: title.replace(/[\s:]+/g, "-"),
    episode,
	}
	arr.push(obj)
})
const $$$$$ = await fetcher('https://m.meownime.ai/tag/ongoing/page/5/')
$$$$$('#main > article').each((i, el) => {
	const title = $(el).find("div > a").attr('title')
	const episode = $(el).find("div > .postedon").text()
	const image = $(el).find("div > a > img").attr('src')
	const obj = {
		title,
		image,
		link: `/anime/${title.replace(/[\s:]+/g, "-") + '-' + episode.replace(/,?[ ]/g, '-')}`,
		anime: title.replace(/[\s:]+/g, "-"),
    episode,
	}
	arr.push(obj)
})

---

<Layout title="Welcome to Astro.">
			{arr.map(i => 
			<a href={i.link} class="flex flex-col items-center w-full h-fit bg-slate-600 text-white text-center relative cursor-pointer group overflow-hidden">
				<h1 class=" p-2 bg-black w-full flex items-center justify-center min-h-[64px] z-10">{i.title}</h1>
				<img src={i.image} alt={i.title} class="z-0 group-hover:scale-125 duration-1000" />
        <div class="bg-yellow-300 absolute top-[33%] left-0 px-2 py-1 text-black">
          {i.episode}
        </div>
			</a> )}
    <!-- <video id="player" playsinline controls class="unredi">
      <source
        src="https://s7.krakenfiles.com/play-video/NjI4ODQ3NGIwYjRjOWQ3Y2PrfAs8JWVpg09Xbq3ckVQME7mkzwFGZbAYp2GJQvuH/YTM5OGZlYjExZWQ2OGQ0N6z2UI27f-Bu40ByVczOCtpoPppwRecWW9H5teUbCVH8"
      />
    </video> -->
    <!-- <div class='video'>
			<iframe width="100%" height="100%" src="https://s7.krakenfiles.com/play-video/NjI4ODQ3NGIwYjRjOWQ3Y2PrfAs8JWVpg09Xbq3ckVQME7mkzwFGZbAYp2GJQvuH/YTM5OGZlYjExZWQ2OGQ0N6z2UI27f-Bu40ByVczOCtpoPppwRecWW9H5teUbCVH8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>
		</div> -->
    <!-- {temp.map(i => <li>{i}</li> )} -->
  <!-- <script src="https://cdn.plyr.io/3.7.3/plyr.polyfilled.js"></script> -->
  <script>
    import Plyr from "plyr";
    const player = new Plyr("#player");

    const video = document.getElementById("player");
    video.onplay = (e) => {
      video.classList.remove("unredi");
    };
  </script>
</Layout>

<style>
  .unredi {
    visibility: hidden;
  }
</style>
